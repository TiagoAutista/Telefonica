<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de T√©cnicos</title>
    <style>
        body {
            background-color: #1a1a2e;
            color: #e0e0ff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
        }

        .main-input {
            width: 100%;
            padding: 10px;
            margin: 6px 0;
            border: 1px solid #555;
            border-radius: 5px;
            box-sizing: border-box;
            font-family: inherit;
        }

        .main-button {
            padding: 10px 16px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            background-color: #007bff;
            margin: 5px;
        }

        #clientList {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        #clientList th,
        #clientList td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        #clientList th {
            background: #333;
            color: #fff;
        }

        .message-success {
            color: #4caf50;
            font-weight: bold;
        }

        .message-error {
            color: #f44336;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <main>
        <h2 style="text-align: center;">CADASTRO DE T√âCNICO</h2>

        <form id="clientForm">
            <input type="text" class="main-input" id="pon" placeholder="Matr√≠cula (ex: MAT12345)" required />
            <input type="text" class="main-input" id="nome" placeholder="Nome Completo" required />
            <input type="tel" class="main-input" id="telefone" placeholder="Telefone (ex: (11) 91234-5678)" required />
            <input type="text" class="main-input" id="regiao" placeholder="Regi√£o (ex: Sul, Norte, etc.)" required />
            <input type="date" class="main-input" id="dataCriacao" required />
            <button type="submit" class="main-button">Cadastrar T√©cnico</button>
            <button type="button" id="cancelEditBtn" class="main-button" style="display:none;">Cancelar</button>
        </form>

        <div style="margin-top: 20px; text-align: center;">
            <input type="file" id="fileImport" style="display:none">
            <button id="importBtn" class="main-button">Importar do JSON</button>
            <button id="clearBtn" class="main-button">Limpar Dados</button>
            <button id="exportBtn" class="main-button">Exportar JSON</button> <!-- Bot√£o para exportar -->
            <button id="toggleA11y" class="main-button">Modo Acess√≠vel</button>
        </div>

        <div style="margin-top: 20px;">
            <input type="text" class="main-input" id="search" placeholder="Buscar t√©cnico..." oninput="searchClient()" />
        </div>

        <table id="clientList">
            <thead>
                <tr>
                    <th>Matr√≠cula</th>
                    <th>Nome</th>
                    <th>Telefone</th>
                    <th>Regi√£o</th>
                    <th>Data de Cria√ß√£o</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div id="message" style="margin-top: 15px;"></div>
    </main>

    <script>
        let tecnicos = JSON.parse(localStorage.getItem('tecnicos')) || []; // Armazena os t√©cnicos

        // Fun√ß√£o para exibir mensagens
        function displayMessage(msg, type) {
            const el = document.getElementById('message');
            el.textContent = msg;
            el.className = type === 'success' ? 'message-success' : 'message-error';
        }

        // Fun√ß√£o para resetar o formul√°rio
        function resetForm() {
            document.getElementById('clientForm').reset();
            document.getElementById('cancelEditBtn').style.display = 'none'; // Esconde bot√£o de cancelar
        }

        // Fun√ß√£o para exibir a lista de t√©cnicos
        function displayTechnicians() {
            const tbody = document.querySelector('#clientList tbody');
            tbody.innerHTML = ''; // Limpa a tabela antes de atualizar

            if (tecnicos.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:12px;">Nenhum t√©cnico encontrado.</td></tr>`;
                return; // Se n√£o houver t√©cnicos, apenas exibe mensagem
            }

            tecnicos.forEach(tecnico => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${tecnico.pon}</td>
                    <td>${tecnico.nome}</td>
                    <td>${tecnico.telefone}</td>
                    <td>${tecnico.regiao}</td>
                    <td>${tecnico.dataCriacao}</td>
                    <td>
                        <button class="main-button" onclick="iniciarEdicao('${tecnico.pon}')">Editar</button>
                        <span class="excluir-btn" onclick="excluirTecnico('${tecnico.pon}')">üóëÔ∏è</span>
                    </td>
                `;
                tbody.appendChild(tr); // Adiciona a linha √† tabela
            });
        }

        // =============== CADASTRO DE T√âCNICOS ===============
        document.getElementById('clientForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const pon = document.getElementById('pon').value.trim();
            const nome = document.getElementById('nome').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            const regiao = document.getElementById('regiao').value.trim();
            const dataCriacao = document.getElementById('dataCriacao').value;

            // Adiciona novo t√©cnico
            if (tecnicos.some(t => t.pon === pon)) {
                displayMessage('Matr√≠cula j√° cadastrada!', 'error');
                return;
            }

            tecnicos.push({ pon, nome, telefone, regiao, dataCriacao });
            localStorage.setItem('tecnicos', JSON.stringify(tecnicos)); // Salva os t√©cnicos
            resetForm(); // Reseta o formul√°rio
            displayTechnicians(); // Atualiza a lista de t√©cnicos
            displayMessage('T√©cnico cadastrado com sucesso!', 'success'); // Mensagem de sucesso
        });

        // Func√£o para excluir um t√©cnico
        function excluirTecnico(pon) {
            if (!confirm(`Deseja excluir o t√©cnico com matr√≠cula ${pon}?`)) return;
            tecnicos = tecnicos.filter(t => t.pon !== pon); // Remove o t√©cnico selecionado
            localStorage.setItem('tecnicos', JSON.stringify(tecnicos)); // Atualiza o localStorage
            displayTechnicians(); // Atualiza a lista de t√©cnicos
            displayMessage('T√©cnico exclu√≠do com sucesso!', 'success'); // Mensagem de sucesso
        }

        // =============== LIMPAR DADOS ===============
        document.getElementById('clearBtn').addEventListener('click', function () {
            if (confirm('Tem certeza de que deseja apagar todos os t√©cnicos? Esta a√ß√£o n√£o pode ser desfeita.')) {
                localStorage.removeItem('tecnicos'); // Limpa os dados do localStorage
                tecnicos = []; // Reinicializa a lista de t√©cnicos
                resetForm(); // Reseta o formul√°rio
                displayTechnicians(); // Atualiza a exibi√ß√£o da lista de t√©cnicos
                displayMessage('Todos os dados foram apagados.', 'success'); // Mensagem de sucesso
            }
        });

  // =============== IMPORTA√á√ÉO ===============
        document.getElementById('importBtn').addEventListener('click', () => {
            document.getElementById('fileImport').click(); // Simula o clique no input de arquivo
        });

        document.getElementById('fileImport').addEventListener('change', function (e) {
            const file = e.target.files[0]; // Obt√©m o primeiro arquivo selecionado
            if (!file) return;

            const reader = new FileReader(); // Cria um objeto FileReader

            reader.onload = function () {
                try {
                    const data = JSON.parse(reader.result); // Tenta converter o resultado para JSON
                    if (!Array.isArray(data)) throw new Error('Esperado um array.');

                    // Valida os dados para garantir que contenham as informa√ß√µes necess√°rias
                    const valid = data.filter(c => c.pon && c.nome && c.telefone && c.regiao && c.dataCriacao);
                    const novos = valid.filter(n => !tecnicos.some(c => c.pon === n.pon));

                    // Adiciona os novos t√©cnicos ao array existente
                    tecnicos = [...tecnicos, ...novos];
                    localStorage.setItem('tecnicos', JSON.stringify(tecnicos));
                    displayTechnicians(); // Atualiza a lista de t√©cnicos
                    displayMessage(`Importado(s): ${novos.length} t√©cnico(s) novo(s)!`, 'success');
                } catch (err) {
                    displayMessage('Erro ao importar: ' + (err.message || 'Arquivo inv√°lido'), 'error');
                } finally {
                    e.target.value = ''; // Limpa o campo de input
                }
            };

            reader.readAsText(file); // L√™ o arquivo como texto
        });
        // =============== EXPORTA√á√ÉO ===============
        document.getElementById('exportBtn').addEventListener('click', function () {
            if (tecnicos.length === 0) {
                displayMessage('N√£o h√° dados para exportar.', 'error');
                return; // Retorna se n√£o houver t√©cnicos cadastrados
            }

            const blob = new Blob([JSON.stringify(tecnicos, null, 2)], { type: 'application/json' }); // Cria um blob com os t√©cnicos
            const url = URL.createObjectURL(blob); // Cria um URL para o blob
            const a = document.createElement('a'); // Cria um link √¢ncora
            a.href = url; // Define o URL do blob
            a.download = `tecnicos_${new Date().toISOString().slice(0, 10)}.json`; // Define o nome do arquivo
            document.body.appendChild(a); // Adiciona o link ao corpo (necess√°rio para alguns navegadores)
            a.click(); // Aciona o download do arquivo
            document.body.removeChild(a); // Remove o link do DOM
            URL.revokeObjectURL(url); // Libera o objeto URL depois de usar

            displayMessage('Exportado com sucesso!', 'success'); // Mensagem de sucesso
        });

        // =============== INICIALIZA√á√ÉO ===============
        document.addEventListener('DOMContentLoaded', () => {
            tecnicos = JSON.parse(localStorage.getItem('tecnicos')) || []; // Carrega t√©cnicos do localStorage
            displayTechnicians(); // Exibe a lista de t√©cnicos na inicializa√ß√£o
        });
    </script>
</body>

</html>
