<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de T√©cnicos</title>
    <link rel="stylesheet" href="styles.css"> <!-- Adicione seu CSS aqui -->

    <style>
        /* Estilos base RPGUI (simulando o rpgui.css) */
        body {
            background: #1a1a2e url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%231a1a2e"/><path d="M0 0L100 100M100 0L0 100" stroke="%232a2a4e" stroke-width="1"/></svg>') repeat;
            color: #e0e0ff;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
            transition: background 0.3s, color 0.3s;
        }

        body.modo-acessivel {
            background: #ffffff !important;
            color: #000000 !important;
        }

        .rpgui-container.framed {
            background: rgba(10, 10, 30, 0.85);
            border: 4px solid #4a5568;
            border-image: repeating-linear-gradient(45deg, #553c9a, #553c9a 10px, #2d1b69 10px, #2d1b69 20px) 10;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
        }

        .rpgui-nav-title {
            color: gold;
            font-size: 1.6em;
            text-align: center;
            margin-bottom: 12px;
            text-shadow: 0 0 6px black;
        }

        .rpgui-nav-list {
            display: flex;
            justify-content: center;
            list-style: none;
            padding: 0;
            margin: 0;
            gap: 16px;
        }

        .rpgui-nav-item a {
            color: #a0a0ff;
            text-decoration: none;
            padding: 6px 12px;
            border: 2px solid transparent;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .rpgui-nav-item a:hover,
        .rpgui-nav-item a.active {
            color: white;
            border-color: gold;
            background: rgba(80, 60, 180, 0.3);
        }

        body.modo-acessivel .rpgui-nav-item a {
            color: #000 !important;
            border-color: #000 !important;
        }

        .main-input {
            width: 100%;
            padding: 10px;
            margin: 6px 0 12px;
            border: 1px solid #555;
            background: rgba(20, 20, 40, 0.8);
            color: white;
            border-radius: 6px;
            box-sizing: border-box;
            font-family: inherit;
        }

        body.modo-acessivel .main-input {
            background: #fff !important;
            color: #000 !important;
            border-color: #000 !important;
        }

        .main-button {
            position: relative;
            margin: 6px 4px;
            padding: 10px 16px;
            font-weight: bold;
            font-size: 0.95em;
            color: white;
            background: linear-gradient(135deg, #2c1e5f, #1a103a);
            border: 2px solid #8a7bff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }

        body.modo-acessivel .main-button {
            color: #000 !important;
            border-color: #000 !important;
        }

        .main-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(138, 123, 255, 0.6);
        }

        .btn-cadastrar {
            background: linear-gradient(135deg, #c00, #800);
            border-color: #ff6666;
        }

        .btn-limpar {
            background: linear-gradient(135deg, #a00, #600);
            border-color: #ff4444;
        }

        .btn-exportar {
            background: linear-gradient(135deg, #0066cc, #003366);
            border-color: #4da6ff;
        }

        .btn-importar {
            background: linear-gradient(135deg, #008000, #004d00);
            border-color: #66ff66;
        }

        .btn-loading {
            opacity: 0.6;
            pointer-events: none;
            cursor: not-allowed;
        }

        #clientList {
            width: 100%;
            margin-top: 16px;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            overflow: hidden;
        }

        #clientList th,
        #clientList td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        #clientList th {
            background: rgba(30, 30, 60, 0.9);
            color: gold;
        }

        body.modo-acessivel #clientList th {
            color: #000 !important;
            background: #eee !important;
        }

        #clientList tbody tr:hover {
            background: rgba(50, 50, 100, 0.5);
        }

        .excluir-btn {
            color: #ff5555;
            cursor: pointer;
            font-weight: bold;
            margin-left: 8px;
            display: inline-block;
        }

        .message-success {
            color: #4caf50;
            font-weight: bold;
        }

        .message-error {
            color: #f44336;
            font-weight: bold;
        }

        #historicoLog {
            margin-top: 20px;
            font-size: 0.85em;
            color: #aaa;
        }

        body.modo-acessivel #historicoLog {
            color: #555 !important;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            font-size: 0.85em;
            color: #ccc;
            text-shadow: 0 0 4px black;
        }
    </style>
</head>

<body>
    <main>
        <h2 style="text-align: center;">CADASTRO DE T√âCNICO</h2>

        <form id="clientForm">
            <input type="text" class="main-input" id="pon" placeholder="Matr√≠cula (ex: MAT12345)" required />
            <input type="text" class="main-input" id="nome" placeholder="Nome Completo" required />
            <input type="tel" class="main-input" id="telefone" placeholder="Telefone (ex: (11) 91234-5678)" required />
            <input type="text" class="main-input" id="regiao" placeholder="Regi√£o (ex: Sul, Norte, etc.)" required />
            <input type="date" class="main-input" id="dataCriacao" required />
            <button type="submit" class="main-button btn-cadastrar">Cadastrar T√©cnico</button>
            <button type="button" id="cancelEditBtn" class="main-button" style="display:none;">Cancelar</button>
        </form>

        <div style="margin-top: 20px; text-align: center;">
            <input type="file" id="fileImport" style="display:none">
            <button id="importBtn" class="main-button">Importar do JSON</button>
            <button id="clearBtn" class="main-button">Limpar Dados</button>
            <button id="exportBtn" class="main-button">Exportar JSON</button>
            <button id="toggleA11y" class="main-button">Modo Acess√≠vel</button>
        </div>

        <div style="margin-top: 20px;">
            <input type="text" class="main-input" id="search" placeholder="Buscar t√©cnico..."
                oninput="searchClient()" />
        </div>

        <table id="clientList">
            <thead>
                <tr>
                    <th>Matr√≠cula</th>
                    <th>Nome</th>
                    <th>Telefone</th>
                    <th>Regi√£o</th>
                    <th>Data de Cria√ß√£o</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div id="message" style="margin-top: 15px;"></div>
        <div id="historicoLog"></div>
    </main>

    <script>
        let tecnicos = JSON.parse(localStorage.getItem('tecnicos')) || []; // Armazena os t√©cnicos
        let historicoTecnicos = JSON.parse(localStorage.getItem('tecnicos_historico')) || []; // Hist√≥rico dos t√©cnicos
        let editingPON = null; // Para editar um t√©cnico

        // =============== FUN√á√ïES UTILITY ===============

        function displayMessage(msg, type) {
            const el = document.getElementById('message');
            el.textContent = msg;
            el.className = type === 'success' ? 'message-success' : 'message-error';
        }

        function resetForm() {
            document.getElementById('clientForm').reset();
            editingPON = null;
            document.querySelector('#clientForm .btn-cadastrar').textContent = 'Cadastrar';
            document.getElementById('cancelEditBtn').style.display = 'none';
        }

        // =============== CADASTRO DE T√âCNICOS ===============
        document.getElementById('clientForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const pon = document.getElementById('pon').value.trim();
            const nome = document.getElementById('nome').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            const regiao = document.getElementById('regiao').value.trim();
            const dataCriacao = document.getElementById('dataCriacao').value;

            if (editingPON) {
                if (pon !== editingPON && tecnicos.some(t => t.pon === pon)) {
                    displayMessage('Matr√≠cula j√° cadastrada!', 'error');
                    return;
                }
                tecnicos = tecnicos.map(t => t.pon === editingPON ? { pon, nome, telefone, regiao, dataCriacao } : t);
            } else {
                if (tecnicos.some(t => t.pon === pon)) {
                    displayMessage('T√©cnico j√° cadastrado!', 'error');
                    return;
                }
                tecnicos.push({ pon, nome, telefone, regiao, dataCriacao });
            }

            localStorage.setItem('tecnicos', JSON.stringify(tecnicos)); // Salva no localStorage
            resetForm();
            displayTechnicians(); // Atualiza a lista de t√©cnicos
            displayMessage(editingPON ? 'Atualizado!' : 'Cadastrado!', 'success');
        });

        // =============== EXIBI√á√ÉO DA LISTA DE T√âCNICOS ===============
        function displayTechnicians(filtered = tecnicos) {
            const tbody = document.querySelector('#clientList tbody');
            tbody.innerHTML = '';

            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:12px;">Nenhum t√©cnico encontrado.</td></tr>`;
                return;
            }

            filtered.forEach(tecnico => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${tecnico.pon}</td>
                    <td>${tecnico.nome}</td>
                    <td>${tecnico.telefone}</td>
                    <td>${tecnico.regiao}</td>
                    <td>${tecnico.dataCriacao}</td>
                    <td>
                        <button class="main-button" onclick="iniciarEdicao('${tecnico.pon}')">Editar</button>
                        <span class="excluir-btn" onclick="excluirTecnico('${tecnico.pon}')">üóëÔ∏è</span>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Exclui um t√©cnico
        function excluirTecnico(pon) {
            if (!confirm(`Deseja excluir o t√©cnico com matr√≠cula ${pon}?`)) return;
            tecnicos = tecnicos.filter(t => t.pon !== pon);
            localStorage.setItem('tecnicos', JSON.stringify(tecnicos));
            resetForm();
            displayTechnicians();
            displayMessage('T√©cnico exclu√≠do com sucesso!', 'success');
        }

        // Inicia a edi√ß√£o de um t√©cnico
        function iniciarEdicao(pon) {
            const tecnico = tecnicos.find(t => t.pon === pon);
            if (!tecnico) return;
            document.getElementById('pon').value = tecnico.pon;
            document.getElementById('nome').value = tecnico.nome;
            document.getElementById('telefone').value = tecnico.telefone;
            document.getElementById('regiao').value = tecnico.regiao;
            document.getElementById('dataCriacao').value = tecnico.dataCriacao; // Adicionando data de cria√ß√£o
            editingPON = tecnico.pon;
            document.querySelector('#clientForm .btn-cadastrar').textContent = 'Atualizar';
            document.getElementById('cancelEditBtn').style.display = 'inline-block';
        }
        // =============== IMPORTA√á√ÉO ===============
        document.getElementById('importBtn').addEventListener('click', () => {
            document.getElementById('fileImport').click(); // Simula o clique no input de arquivo
        });

        document.getElementById('fileImport').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            const btn = document.getElementById('importBtn');
            const orig = btn.textContent;
            setLoading(btn, true, orig);

            reader.onload = function () {
                try {
                    const data = JSON.parse(reader.result);
                    if (!Array.isArray(data)) throw new Error('Esperado um array.');
                    const valid = data.filter(t => t.pon && t.nome && t.telefone && t.regiao); // Removendo CPF
                    const novos = valid.filter(n => !tecnicos.some(t => t.pon === n.pon));
                    tecnicos = [...tecnicos, ...novos];
                    localStorage.setItem('tecnicos', JSON.stringify(tecnicos));
                    displayTechnicians();
                    displayMessage(`Importado(s): ${novos.length} t√©cnico(s) novo(s)!`, 'success');
                } catch (err) {
                    displayMessage('Erro ao importar: ' + (err.message || 'Arquivo inv√°lido'), 'error');
                } finally {
                    setLoading(btn, false, orig);
                    e.target.value = ''; // Limpa a sele√ß√£o ap√≥s a importa√ß√£o
                }
            };
            reader.readAsText(file);
        });

        // =============== EXPORTA√á√ÉO ===============
        document.getElementById('exportBtn').addEventListener('click', function () {
            if (tecnicos.length === 0) {
                displayMessage('N√£o h√° dados para exportar.', 'error');
                return; // Retorna se n√£o houver t√©cnicos cadastrados
            }

            const btn = this;
            const orig = btn.textContent; // Armazena o texto original do bot√£o
            setLoading(btn, true, orig); // Indica que a exporta√ß√£o est√° em andamento

            setTimeout(() => {
                const blob = new Blob([JSON.stringify(tecnicos, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob); // Cria um URL para o Blob
                const a = document.createElement('a'); // Cria um elemento √¢ncora
                a.href = url; // Define o href como o URL do Blob
                a.download = `tecnicos_${new Date().toISOString().slice(0, 10)}.json`; // Define o nome do arquivo
                a.click(); // Aciona o download
                URL.revokeObjectURL(url); // Libera o objeto URL

                displayMessage('Exportado com sucesso!', 'success'); // Mensagem de sucesso
                setLoading(btn, false, orig); // Restaura o estado do bot√£o
            }, 200); // Pequeno atraso para simular carga
        });

        // =============== LIMPAR DADOS ===============
        document.getElementById('clearBtn').addEventListener('click', function () {
            if (confirm('Tem certeza de que deseja apagar todos os t√©cnicos? Esta a√ß√£o n√£o pode ser desfeita.')) {
                const btn = this;
                const orig = btn.textContent; // Armazena o texto original do bot√£o
                setLoading(btn, true, orig); // Indica que a opera√ß√£o est√° em andamento

                setTimeout(() => {
                    localStorage.removeItem('tecnicos'); // Remove os dados dos t√©cnicos do localStorage
                    tecnicos = []; // Reinicializa a lista de t√©cnicos para um array vazio
                    resetForm(); // Reseta o formul√°rio para o estado inicial
                    displayTechnicians(); // Atualiza a exibi√ß√£o da lista de t√©cnicos
                    displayMessage('Todos os dados foram apagados.', 'success'); // Mensagem de sucesso
                    setLoading(btn, false, orig); // Restaura o estado do bot√£o
                }, 200); // Atraso pequeno para simular a a√ß√£o
            }
        });

        // Fun√ß√£o de exibi√ß√£o da lista de t√©cnicos
        function displayTechnicians(filtered = tecnicos) {
            const tbody = document.querySelector('#clientList tbody');
            tbody.innerHTML = ''; // Limpa a tabela antes de atualizar

            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:12px;">Nenhum t√©cnico encontrado.</td></tr>`;
                return; // Se n√£o houver t√©cnicos, apenas exibe mensagem
            }

            filtered.forEach(tecnico => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${tecnico.pon}</td>
            <td>${tecnico.nome}</td>
            <td>${tecnico.telefone}</td>
            <td>${tecnico.regiao}</td>
            <td>${tecnico.dataCriacao}</td>
            <td>
                <button class="main-button" onclick="iniciarEdicao('${tecnico.pon}')">Editar</button>
                <span class="excluir-btn" onclick="excluirTecnico('${tecnico.pon}')">üóëÔ∏è</span>
            </td>
        `;
                tbody.appendChild(tr); // Adiciona a linha √† tabela
            });
        }

        // Fun√ß√£o para resetar o formul√°rio
        function resetForm() {
            document.getElementById('clientForm').reset(); // Reseta os campos do formul√°rio
            editingPON = null; // Reinicia a vari√°vel de edi√ß√£o
            document.querySelector('#clientForm .btn-cadastrar').textContent = 'Cadastrar'; // Altera bot√£o de cadastrar
            document.getElementById('cancelEditBtn').style.display = 'none'; // Esconde bot√£o de cancelar
        }

        // Fun√ß√£o para exibir mensagens de feedback
        function displayMessage(msg, type) {
            const el = document.getElementById('message');
            el.textContent = msg; // Define o texto da mensagem
            el.className = type === 'success' ? 'message-success' : 'message-error'; // Altera a classe para estiliza√ß√£o
        }

        // Atualizar a inicializa√ß√£o para verificar t√©cnicos ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            tecnicos = JSON.parse(localStorage.getItem('tecnicos')) || []; // Carrega t√©cnicos do localStorage
            displayTechnicians(); // Exibe a lista de t√©cnicos na inicializa√ß√£o
        });

        // =============== MODO ACESS√çVEL ===============
        document.getElementById('toggleA11y').addEventListener('click', () => {
            document.body.classList.toggle('modo-acessivel');
            localStorage.setItem('modoAcessivel', document.body.classList.contains('modo-acessivel'));
            displayMessage('Modo acess√≠vel ativado/desativado.', 'info');
        });

        // =============== INICIALIZA√á√ÉO ===============
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('modoAcessivel') === 'true') {
                document.body.classList.add('modo-acessivel');
            }
            displayTechnicians(); // Exibe a lista de t√©cnicos na inicializa√ß√£o
            document.getElementById('pon').focus(); // Foca no campo de matr√≠cula ao carregar
        });
    </script>
</body>

</html>
</body>

</html>
