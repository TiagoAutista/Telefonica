<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KOF - Cadastro de Técnicos</title>
  <link rel="stylesheet" href="./assets/css/index.css" type="text/css">
  <style>
    body {
      background: #000 url('./assets/img/kof-bg-stadium.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
      font-family: 'Arial', sans-serif;
      transition: background 0.3s, color 0.3s;
    }

    body.modo-acessivel {
      background: #ffffff !important;
      color: #000000 !important;
    }

    .message-success {
      color: #4caf50;
      font-weight: bold;
    }
    .message-error {
      color: #f44336;
      font-weight: bold;
    }

    .main-input {
      width: 100%;
      padding: 10px;
      margin: 6px 0 12px;
      border: 1px solid #666;
      background: rgba(30, 30, 30, 0.8);
      color: white;
      border-radius: 6px;
      box-sizing: border-box;
      transition: background 0.2s, color 0.2s;
    }

    body.modo-acessivel .main-input {
      background: #fff !important;
      color: #000 !important;
      border-color: #000 !important;
    }

    .main-button {
      position: relative;
      margin: 6px 4px;
      padding: 12px 20px;
      font-weight: bold;
      font-size: 1em;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: white;
      background: linear-gradient(135deg, #222, #000);
      border: 2px solid gold;
      border-radius: 8px;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
      outline: none;
    }

    body.modo-acessivel .main-button {
      color: #000 !important;
      border-color: #000 !important;
    }

    .main-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.6s;
    }

    .main-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
      border-color: #ffcc00;
    }

    .main-button:hover::before {
      left: 100%;
    }

    .main-button:active {
      transform: translateY(1px);
      box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    .main-button:focus {
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.5);
    }

    .btn-cadastrar {
      background: linear-gradient(135deg, #c00, #800);
      border-color: #ff5555;
      box-shadow: 0 0 10px rgba(255, 85, 85, 0.5);
    }
    .btn-cadastrar:hover {
      border-color: #ff8888;
      box-shadow: 0 0 20px rgba(255, 85, 85, 0.8);
    }

    .btn-limpar {
      background: linear-gradient(135deg, #a00, #600);
      border-color: #ff4444;
    }

    .btn-exportar {
      background: linear-gradient(135deg, #0066cc, #003366);
      border-color: #4da6ff;
      box-shadow: 0 0 10px rgba(77, 166, 255, 0.4);
    }
    .btn-exportar:hover {
      box-shadow: 0 0 20px rgba(77, 166, 255, 0.7);
    }

    .btn-importar {
      background: linear-gradient(135deg, #008000, #004d00);
      border-color: #66ff66;
      box-shadow: 0 0 10px rgba(102, 255, 102, 0.4);
    }
    .btn-importar:hover {
      box-shadow: 0 0 20px rgba(102, 255, 102, 0.7);
    }

    .btn-loading {
      opacity: 0.7;
      pointer-events: none;
      cursor: not-allowed;
    }

    .tech-list-item {
      padding: 10px;
      margin: 6px 0;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid #555;
      border-left: 4px solid gold;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }

    body.modo-acessivel .tech-list-item {
      background: #f0f0f0 !important;
      color: #000 !important;
      border-color: #000 !important;
    }

    .tech-list-item:hover {
      background: rgba(30, 30, 30, 0.8);
    }

    .excluir-btn {
      float: right;
      color: #ff5555;
      cursor: pointer;
      font-weight: bold;
      margin-left: 10px;
    }

    .header-banner {
      background: url('./assets/img/kof-title-banner.png') no-repeat center;
      background-size: contain;
      height: 60px;
      margin-bottom: 20px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      color: gold;
      font-weight: bold;
      font-size: 1.4em;
      text-shadow: 0 0 8px black;
    }

    body.modo-acessivel .header-banner {
      color: #000 !important;
      text-shadow: none !important;
    }

    .avatar-placeholder img {
      width: 100px;
      height: auto;
      border: 2px solid gold;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    #superSuccess {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #superSuccess img {
      max-width: 60%;
      animation: pulse 1.5s ease-out;
    }

    @keyframes pulse {
      0% { transform: scale(0.8); opacity: 0; }
      70% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    #historicoLog {
      margin-top: 20px;
      font-size: 0.85em;
      color: #aaa;
    }

    body.modo-acessivel #historicoLog {
      color: #555 !important;
    }

    /* Lista aprimorada */
    #techList {
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 8px;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
      scrollbar-width: thin;
      scrollbar-color: gold rgba(30, 30, 30, 0.6);
    }

    /* Barra de rolagem (Chrome/Edge) */
    #techList::-webkit-scrollbar {
      width: 10px;
    }
    #techList::-webkit-scrollbar-track {
      background: rgba(30, 30, 30, 0.6);
      border-radius: 5px;
    }
    #techList::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, gold, #d4af37);
      border-radius: 5px;
      border: 2px solid rgba(0, 0, 0, 0.3);
    }
    #techList::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, #ffcc00, gold);
    }
  </style>
</head>

<body>
  <!-- Overlay de Super Ataque -->
  <div id="superSuccess">
    <img src="./assets/img/super-attack-kof.gif" alt="SUPER TÉCNICO!">
  </div>

  <!-- Input oculto para importação de arquivo -->
  <input type="file" id="fileImport" accept=".json" style="display: none;" />

  <div class="main-ui">
    <div class="main-content">
      <section>
        <div>
          <header class="justify-content-center">
            <nav class="main-nav main-container framed" style="height: 120px; width: 80%; padding-top: 25px; background: rgba(0,0,0,0.7);">
              <div class="main-nav-title">TEAM SELECT</div>
              <ul class="main-nav-list">
                <li class="main-nav-item"><a class="main-nav-link" href="/index.html">HOME</a></li>
                <li class="main-nav-item"><a class="main-nav-link active" href="#">CADASTRO TÉCNICOS</a></li>
                <li class="main-nav-item"><a class="main-nav-link" href="#">PROJETO</a></li>
                <li class="main-nav-item"><a class="main-nav-link" href="#">ACESSOS</a></li>
                <li class="main-nav-item"><a class="main-nav-link" href="#">TELEFÔNICA</a></li>
              </ul>
            </nav>
          </header>
        </div>
      </section>

      <section>
        <div>
          <main class="main-container framed" style="width: 80%; margin-top: 20px; padding: 25px; background: rgba(10, 10, 20, 0.85); backdrop-filter: blur(2px);">
            
            <div class="header-banner">CADASTRO DE TÉCNICOS</div>

            <div class="avatar-placeholder">
              <img src="./assets/img/tech-fighter-kof.png" alt="Tech Fighter">
            </div>

            <form id="techForm">
              <input type="text" class="main-input" id="matricula" placeholder="Matrícula" required />
              <input type="text" class="main-input" id="name" placeholder="Nome" required />
              <input type="text" class="main-input" id="telefone" placeholder="Telefone (ex: (11) 99999-9999)" required />
              <input type="text" class="main-input" id="specialty" placeholder="Especialidade" required />
              <button type="submit" class="main-button btn-cadastrar">Cadastrar</button>
              <button type="button" id="cancelEditBtn" class="main-button" style="display:none; background: linear-gradient(to bottom, #555, #333);">Cancelar</button>
            </form>

            <div style="margin-top: 25px; text-align: center;">
              <button id="importBtn" class="main-button btn-importar">Importar do JSON</button>
              <button id="clearBtn" class="main-button btn-limpar">Limpar Dados</button>
              <button id="exportBtn" class="main-button btn-exportar">Exportar JSON</button>
              <button id="toggleA11y" class="main-button" style="margin-top:10px; font-size:0.85em; padding:6px 12px;">Modo Acessível</button>
            </div>

            <div style="margin-top: 25px;">
              <input type="text" class="main-input" id="search" placeholder="Buscar técnico..." oninput="searchTech()" />
            </div>

            <div id="techList" role="list" aria-label="Lista de técnicos cadastrados"></div>

            <div id="message" style="margin-top: 15px; min-height: 24px;"></div>

            <div id="historicoLog"></div>
          </main>

          <footer style="text-align: center; margin-top: 40px; font-size: 0.85em; color: #ccc; text-shadow: 0 0 4px black;">
            © 2025 KING OF FIGHTERS - TELEFÔNICA OPERATIONS
          </footer>
        </div>
      </section>
    </div>
  </div>

  <script>
    let techs = JSON.parse(localStorage.getItem('techs')) || [];
    let editingMatricula = null;
    let historico = JSON.parse(localStorage.getItem('techs_historico')) || [];
    let backupInterval = null;

    // =============== UTILITÁRIOS ===============
    function validarTelefone(telefone) {
      const digits = telefone.replace(/\D/g, '');
      return digits.length === 10 || digits.length === 11;
    }

    function displayMessage(msg, type) {
      const el = document.getElementById('message');
      el.textContent = msg;
      el.className = type === 'success' ? 'message-success' : 'message-error';
    }

    function setLoading(button, isLoading, originalText) {
      if (isLoading) {
        button.classList.add('btn-loading');
        button.disabled = true;
        button.textContent = 'Aguarde...';
      } else {
        button.classList.remove('btn-loading');
        button.disabled = false;
        button.textContent = originalText;
      }
    }

    function resetForm() {
      document.getElementById('techForm').reset();
      editingMatricula = null;
      document.querySelector('#techForm .btn-cadastrar').textContent = 'Cadastrar';
      document.getElementById('cancelEditBtn').style.display = 'none';
    }

    // =============== HISTÓRICO ===============
    function adicionarAoHistorico(acao) {
      const entrada = `${new Date().toLocaleTimeString()} - ${acao}`;
      historico.unshift(entrada);
      historico = historico.slice(0, 10);
      localStorage.setItem('techs_historico', JSON.stringify(historico));
      atualizarHistoricoUI();
    }

    function atualizarHistoricoUI() {
      const div = document.getElementById('historicoLog');
      div.innerHTML = '<strong>Últimas ações:</strong><br>' + (historico.length ? historico.join('<br>') : 'Nenhuma ação registrada.');
    }

    // =============== EXCLUSÃO ===============
    function excluirTecnico(matricula) {
      if (!confirm(`Deseja excluir o técnico de matrícula ${matricula}?`)) return;
      techs = techs.filter(t => t.matricula !== matricula);
      localStorage.setItem('techs', JSON.stringify(techs));
      resetForm();
      displayTechs();
      displayMessage('Técnico excluído com sucesso!', 'success');
      adicionarAoHistorico(`Excluído: ${matricula}`);
    }

    // =============== BACKUP AUTOMÁTICO ===============
    function criarBackup() {
      const agora = new Date();
      const timestamp = `${agora.getFullYear()}${String(agora.getMonth()+1).padStart(2,'0')}${String(agora.getDate()).padStart(2,'0')}_${String(agora.getHours()).padStart(2,'0')}${String(agora.getMinutes()).padStart(2,'0')}`;
      localStorage.setItem(`techs_backup_${timestamp}`, JSON.stringify(techs));
    }

    function iniciarBackupAutomatico() {
      if (backupInterval) clearInterval(backupInterval);
      backupInterval = setInterval(criarBackup, 5 * 60 * 1000);
    }

    // =============== MODO ACESSÍVEL ===============
    function alternarModoAcessivel() {
      document.body.classList.toggle('modo-acessivel');
      const ativo = document.body.classList.contains('modo-acessivel');
      localStorage.setItem('modoAcessivel', ativo);
    }

    // =============== ATALHOS DE TECLADO ===============
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        e.preventDefault();
        document.getElementById('techForm').dispatchEvent(new Event('submit'));
      }
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'l') {
        e.preventDefault();
        resetForm();
      }
      if (e.key === 'Escape' && editingMatricula) {
        resetForm();
      }
    });

    // =============== EXIBIÇÃO DA LISTA ===============
    function displayTechs(filtered = techs) {
      const list = document.getElementById('techList');
      list.innerHTML = '';
      if (filtered.length === 0) {
        list.innerHTML = '<div class="tech-list-item">Nenhum técnico encontrado.</div>';
        return;
      }
      filtered.forEach(tech => {
        const div = document.createElement('div');
        div.className = 'tech-list-item';
        div.setAttribute('role', 'listitem');
        div.innerHTML = `
          Matrícula: ${tech.matricula} | Nome: ${tech.name} | Tel: ${tech.telefone} | Esp: ${tech.specialty}
          <span class="excluir-btn" title="Excluir">🗑️</span>
        `;
        div.addEventListener('click', (e) => {
          if (!e.target.classList.contains('excluir-btn')) {
            iniciarEdicao(tech);
          }
        });
        div.querySelector('.excluir-btn').addEventListener('click', (e) => {
          e.stopPropagation();
          excluirTecnico(tech.matricula);
        });
        list.appendChild(div);
      });
    }

    // =============== EDIÇÃO ===============
    function iniciarEdicao(tech) {
      document.getElementById('matricula').value = tech.matricula;
      document.getElementById('name').value = tech.name;
      document.getElementById('telefone').value = tech.telefone;
      document.getElementById('specialty').value = tech.specialty;
      editingMatricula = tech.matricula;
      document.querySelector('#techForm .btn-cadastrar').textContent = 'Atualizar';
      document.getElementById('cancelEditBtn').style.display = 'inline-block';
    }

    // =============== SUBMISSÃO ===============
    document.getElementById('techForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const matricula = document.getElementById('matricula').value.trim();
      const name = document.getElementById('name').value.trim();
      const telefone = document.getElementById('telefone').value.trim();
      const specialty = document.getElementById('specialty').value.trim();

      if (!validarTelefone(telefone)) {
        displayMessage('Telefone inválido! Use o formato (XX) 9XXXX-XXXX.', 'error');
        return;
      }

      if (editingMatricula) {
        if (matricula !== editingMatricula && techs.some(t => t.matricula === matricula)) {
          displayMessage('Matrícula já cadastrada!', 'error');
          return;
        }
        techs = techs.map(t => t.matricula === editingMatricula ? { matricula, name, telefone, specialty } : t);
        adicionarAoHistorico(`Atualizado: ${matricula} (${name})`);
      } else {
        if (techs.some(t => t.matricula === matricula)) {
          displayMessage('Técnico já cadastrado!', 'error');
          return;
        }
        techs.push({ matricula, name, telefone, specialty });
        adicionarAoHistorico(`Cadastrado: ${matricula} (${name})`);
      }

      localStorage.setItem('techs', JSON.stringify(techs));
      resetForm();
      displayTechs();
      displayMessage(editingMatricula ? 'Atualizado!' : 'Cadastrado!', 'success');

      const overlay = document.getElementById('superSuccess');
      overlay.style.display = 'flex';
      setTimeout(() => overlay.style.display = 'none', 2000);
    });

    // =============== IMPORTAÇÃO VIA ARQUIVO LOCAL ===============
    document.getElementById('importBtn').addEventListener('click', function () {
      document.getElementById('fileImport').click();
    });

    document.getElementById('fileImport').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      const btn = document.getElementById('importBtn');
      const originalText = btn.textContent;
      setLoading(btn, true, originalText);

      reader.onload = function (e) {
        try {
          const data = JSON.parse(e.target.result);

          if (!Array.isArray(data)) {
            throw new Error('O arquivo deve conter um array de técnicos.');
          }

          const validData = data.filter(item =>
            item.matricula !== undefined &&
            item.name !== undefined &&
            item.telefone !== undefined &&
            item.specialty !== undefined
          );

          if (validData.length === 0) {
            throw new Error('Nenhum técnico válido encontrado.');
          }

          const newTechs = validData.filter(d => !techs.some(t => t.matricula === d.matricula));
          techs = [...techs, ...newTechs];
          localStorage.setItem('techs', JSON.stringify(techs));

          displayTechs();
          displayMessage(`Importado(s): ${newTechs.length} técnico(s) novo(s)!`, 'success');
          adicionarAoHistorico(`Importados do arquivo: ${newTechs.length} técnicos`);

        } catch (err) {
          console.error(err);
          displayMessage('Erro ao importar: ' + (err.message || 'Arquivo inválido'), 'error');
        } finally {
          setLoading(btn, false, originalText);
          event.target.value = '';
        }
      };

      reader.onerror = function () {
        displayMessage('Erro ao ler o arquivo.', 'error');
        setLoading(btn, false, originalText);
      };

      reader.readAsText(file);
    });

    // =============== LIMPAR ===============
    document.getElementById('clearBtn').addEventListener('click', function () {
      if (confirm('Apagar todos os dados?')) {
        const btn = this;
        const original = btn.textContent;
        setLoading(btn, true, original);
        setTimeout(() => {
          localStorage.removeItem('techs');
          techs = [];
          resetForm();
          displayTechs();
          displayMessage('Dados apagados!', 'success');
          adicionarAoHistorico('Todos os dados apagados');
          setLoading(btn, false, original);
        }, 300);
      }
    });

    // =============== EXPORTAR ===============
    document.getElementById('exportBtn').addEventListener('click', function () {
      const btn = this;
      const original = btn.textContent;
      setLoading(btn, true, original);
      setTimeout(() => {
        const blob = new Blob([JSON.stringify(techs, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        Object.assign(a, { href: url, download: 'tecnicos.json' });
        a.click();
        URL.revokeObjectURL(url);
        displayMessage('Exportado!', 'success');
        setLoading(btn, false, original);
      }, 200);
    });

    // =============== CANCELAR EDIÇÃO ===============
    document.getElementById('cancelEditBtn').addEventListener('click', resetForm);

    // =============== BUSCA ===============
    function searchTech() {
      const q = document.getElementById('search').value.toLowerCase();
      const f = techs.filter(t =>
        t.name.toLowerCase().includes(q) ||
        t.specialty.toLowerCase().includes(q) ||
        t.matricula.includes(q) ||
        t.telefone.includes(q)
      );
      displayTechs(f);
    }

    // =============== INICIALIZAÇÃO ===============
    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('modoAcessivel') === 'true') {
        document.body.classList.add('modo-acessivel');
      }

      displayTechs();
      atualizarHistoricoUI();
      iniciarBackupAutomatico();
      document.getElementById('matricula').focus();

      document.getElementById('toggleA11y').addEventListener('click', alternarModoAcessivel);
    });
  </script>
</body>
</html><!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KOF - Cadastro de Técnicos</title>
  <link rel="stylesheet" href="./assets/css/index.css" type="text/css">
  <style>
    body {
      background: #000 url('./assets/img/kof-bg-stadium.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
      font-family: 'Arial', sans-serif;
      transition: background 0.3s, color 0.3s;
    }

    body.modo-acessivel {
      background: #ffffff !important;
      color: #000000 !important;
    }

    .message-success {
      color: #4caf50;
      font-weight: bold;
    }
    .message-error {
      color: #f44336;
      font-weight: bold;
    }

    .main-input {
      width: 100%;
      padding: 10px;
      margin: 6px 0 12px;
      border: 1px solid #666;
      background: rgba(30, 30, 30, 0.8);
      color: white;
      border-radius: 6px;
      box-sizing: border-box;
      transition: background 0.2s, color 0.2s;
    }

    body.modo-acessivel .main-input {
      background: #fff !important;
      color: #000 !important;
      border-color: #000 !important;
    }

    .main-button {
      position: relative;
      margin: 6px 4px;
      padding: 12px 20px;
      font-weight: bold;
      font-size: 1em;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: white;
      background: linear-gradient(135deg, #222, #000);
      border: 2px solid gold;
      border-radius: 8px;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
      outline: none;
    }

    body.modo-acessivel .main-button {
      color: #000 !important;
      border-color: #000 !important;
    }

    .main-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.6s;
    }

    .main-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
      border-color: #ffcc00;
    }

    .main-button:hover::before {
      left: 100%;
    }

    .main-button:active {
      transform: translateY(1px);
      box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    .main-button:focus {
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.5);
    }

    .btn-cadastrar {
      background: linear-gradient(135deg, #c00, #800);
      border-color: #ff5555;
      box-shadow: 0 0 10px rgba(255, 85, 85, 0.5);
    }
    .btn-cadastrar:hover {
      border-color: #ff8888;
      box-shadow: 0 0 20px rgba(255, 85, 85, 0.8);
    }

    .btn-limpar {
      background: linear-gradient(135deg, #a00, #600);
      border-color: #ff4444;
    }

    .btn-exportar {
      background: linear-gradient(135deg, #0066cc, #003366);
      border-color: #4da6ff;
      box-shadow: 0 0 10px rgba(77, 166, 255, 0.4);
    }
    .btn-exportar:hover {
      box-shadow: 0 0 20px rgba(77, 166, 255, 0.7);
    }

    .btn-importar {
      background: linear-gradient(135deg, #008000, #004d00);
      border-color: #66ff66;
      box-shadow: 0 0 10px rgba(102, 255, 102, 0.4);
    }
    .btn-importar:hover {
      box-shadow: 0 0 20px rgba(102, 255, 102, 0.7);
    }

    .btn-loading {
      opacity: 0.7;
      pointer-events: none;
      cursor: not-allowed;
    }

    .tech-list-item {
      padding: 10px;
      margin: 6px 0;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid #555;
      border-left: 4px solid gold;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }

    body.modo-acessivel .tech-list-item {
      background: #f0f0f0 !important;
      color: #000 !important;
      border-color: #000 !important;
    }

    .tech-list-item:hover {
      background: rgba(30, 30, 30, 0.8);
    }

    .excluir-btn {
      float: right;
      color: #ff5555;
      cursor: pointer;
      font-weight: bold;
      margin-left: 10px;
    }

    .header-banner {
      background: url('./assets/img/kof-title-banner.png') no-repeat center;
      background-size: contain;
      height: 60px;
      margin-bottom: 20px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      color: gold;
      font-weight: bold;
      font-size: 1.4em;
      text-shadow: 0 0 8px black;
    }

    body.modo-acessivel .header-banner {
      color: #000 !important;
      text-shadow: none !important;
    }

    .avatar-placeholder img {
      width: 100px;
      height: auto;
      border: 2px solid gold;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    #superSuccess {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #superSuccess img {
      max-width: 60%;
      animation: pulse 1.5s ease-out;
    }

    @keyframes pulse {
      0% { transform: scale(0.8); opacity: 0; }
      70% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    #historicoLog {
      margin-top: 20px;
      font-size: 0.85em;
      color: #aaa;
    }

    body.modo-acessivel #historicoLog {
      color: #555 !important;
    }

    /* Lista aprimorada */
    #techList {
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 8px;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
      scrollbar-width: thin;
      scrollbar-color: gold rgba(30, 30, 30, 0.6);
    }

    /* Barra de rolagem (Chrome/Edge) */
    #techList::-webkit-scrollbar {
      width: 10px;
    }
    #techList::-webkit-scrollbar-track {
      background: rgba(30, 30, 30, 0.6);
      border-radius: 5px;
    }
    #techList::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, gold, #d4af37);
      border-radius: 5px;
      border: 2px solid rgba(0, 0, 0, 0.3);
    }
    #techList::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, #ffcc00, gold);
    }
  </style>
</head>

<body>
  <!-- Overlay de Super Ataque -->
  <div id="superSuccess">
    <img src="./assets/img/super-attack-kof.gif" alt="SUPER TÉCNICO!">
  </div>

  <!-- Input oculto para importação de arquivo -->
  <input type="file" id="fileImport" accept=".json" style="display: none;" />

  <div class="main-ui">
    <div class="main-content">
      <section>
        <div>
          <header class="justify-content-center">
            <nav class="main-nav main-container framed" style="height: 120px; width: 80%; padding-top: 25px; background: rgba(0,0,0,0.7);">
              <div class="main-nav-title">TEAM SELECT</div>
              <ul class="main-nav-list">
                <li class="main-nav-item"><a class="main-nav-link" href="/index.html">HOME</a></li>
                <li class="main-nav-item"><a class="main-nav-link active" href="#">CADASTRO TÉCNICOS</a></li>
                <li class="main-nav-item"><a class="main-nav-link" href="#">PROJETO</a></li>
                <li class="main-nav-item"><a class="main-nav-link" href="#">ACESSOS</a></li>
                <li class="main-nav-item"><a class="main-nav-link" href="#">TELEFÔNICA</a></li>
              </ul>
            </nav>
          </header>
        </div>
      </section>

      <section>
        <div>
          <main class="main-container framed" style="width: 80%; margin-top: 20px; padding: 25px; background: rgba(10, 10, 20, 0.85); backdrop-filter: blur(2px);">
            
            <div class="header-banner">CADASTRO DE TÉCNICOS</div>

            <div class="avatar-placeholder">
              <img src="./assets/img/tech-fighter-kof.png" alt="Tech Fighter">
            </div>

            <form id="techForm">
              <input type="text" class="main-input" id="matricula" placeholder="Matrícula" required />
              <input type="text" class="main-input" id="name" placeholder="Nome" required />
              <input type="text" class="main-input" id="telefone" placeholder="Telefone (ex: (11) 99999-9999)" required />
              <input type="text" class="main-input" id="specialty" placeholder="Especialidade" required />
              <button type="submit" class="main-button btn-cadastrar">Cadastrar</button>
              <button type="button" id="cancelEditBtn" class="main-button" style="display:none; background: linear-gradient(to bottom, #555, #333);">Cancelar</button>
            </form>

            <div style="margin-top: 25px; text-align: center;">
              <button id="importBtn" class="main-button btn-importar">Importar do JSON</button>
              <button id="clearBtn" class="main-button btn-limpar">Limpar Dados</button>
              <button id="exportBtn" class="main-button btn-exportar">Exportar JSON</button>
              <button id="toggleA11y" class="main-button" style="margin-top:10px; font-size:0.85em; padding:6px 12px;">Modo Acessível</button>
            </div>

            <div style="margin-top: 25px;">
              <input type="text" class="main-input" id="search" placeholder="Buscar técnico..." oninput="searchTech()" />
            </div>

            <div id="techList" role="list" aria-label="Lista de técnicos cadastrados"></div>

            <div id="message" style="margin-top: 15px; min-height: 24px;"></div>

            <div id="historicoLog"></div>
          </main>

          <footer style="text-align: center; margin-top: 40px; font-size: 0.85em; color: #ccc; text-shadow: 0 0 4px black;">
            © 2025 KING OF FIGHTERS - TELEFÔNICA OPERATIONS
          </footer>
        </div>
      </section>
    </div>
  </div>

  <script>
    let techs = JSON.parse(localStorage.getItem('techs')) || [];
    let editingMatricula = null;
    let historico = JSON.parse(localStorage.getItem('techs_historico')) || [];
    let backupInterval = null;

    // =============== UTILITÁRIOS ===============
    function validarTelefone(telefone) {
      const digits = telefone.replace(/\D/g, '');
      return digits.length === 10 || digits.length === 11;
    }

    function displayMessage(msg, type) {
      const el = document.getElementById('message');
      el.textContent = msg;
      el.className = type === 'success' ? 'message-success' : 'message-error';
    }

    function setLoading(button, isLoading, originalText) {
      if (isLoading) {
        button.classList.add('btn-loading');
        button.disabled = true;
        button.textContent = 'Aguarde...';
      } else {
        button.classList.remove('btn-loading');
        button.disabled = false;
        button.textContent = originalText;
      }
    }

    function resetForm() {
      document.getElementById('techForm').reset();
      editingMatricula = null;
      document.querySelector('#techForm .btn-cadastrar').textContent = 'Cadastrar';
      document.getElementById('cancelEditBtn').style.display = 'none';
    }

    // =============== HISTÓRICO ===============
    function adicionarAoHistorico(acao) {
      const entrada = `${new Date().toLocaleTimeString()} - ${acao}`;
      historico.unshift(entrada);
      historico = historico.slice(0, 10);
      localStorage.setItem('techs_historico', JSON.stringify(historico));
      atualizarHistoricoUI();
    }

    function atualizarHistoricoUI() {
      const div = document.getElementById('historicoLog');
      div.innerHTML = '<strong>Últimas ações:</strong><br>' + (historico.length ? historico.join('<br>') : 'Nenhuma ação registrada.');
    }

    // =============== EXCLUSÃO ===============
    function excluirTecnico(matricula) {
      if (!confirm(`Deseja excluir o técnico de matrícula ${matricula}?`)) return;
      techs = techs.filter(t => t.matricula !== matricula);
      localStorage.setItem('techs', JSON.stringify(techs));
      resetForm();
      displayTechs();
      displayMessage('Técnico excluído com sucesso!', 'success');
      adicionarAoHistorico(`Excluído: ${matricula}`);
    }

    // =============== BACKUP AUTOMÁTICO ===============
    function criarBackup() {
      const agora = new Date();
      const timestamp = `${agora.getFullYear()}${String(agora.getMonth()+1).padStart(2,'0')}${String(agora.getDate()).padStart(2,'0')}_${String(agora.getHours()).padStart(2,'0')}${String(agora.getMinutes()).padStart(2,'0')}`;
      localStorage.setItem(`techs_backup_${timestamp}`, JSON.stringify(techs));
    }

    function iniciarBackupAutomatico() {
      if (backupInterval) clearInterval(backupInterval);
      backupInterval = setInterval(criarBackup, 5 * 60 * 1000);
    }

    // =============== MODO ACESSÍVEL ===============
    function alternarModoAcessivel() {
      document.body.classList.toggle('modo-acessivel');
      const ativo = document.body.classList.contains('modo-acessivel');
      localStorage.setItem('modoAcessivel', ativo);
    }

    // =============== ATALHOS DE TECLADO ===============
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        e.preventDefault();
        document.getElementById('techForm').dispatchEvent(new Event('submit'));
      }
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'l') {
        e.preventDefault();
        resetForm();
      }
      if (e.key === 'Escape' && editingMatricula) {
        resetForm();
      }
    });

    // =============== EXIBIÇÃO DA LISTA ===============
    function displayTechs(filtered = techs) {
      const list = document.getElementById('techList');
      list.innerHTML = '';
      if (filtered.length === 0) {
        list.innerHTML = '<div class="tech-list-item">Nenhum técnico encontrado.</div>';
        return;
      }
      filtered.forEach(tech => {
        const div = document.createElement('div');
        div.className = 'tech-list-item';
        div.setAttribute('role', 'listitem');
        div.innerHTML = `
          Matrícula: ${tech.matricula} | Nome: ${tech.name} | Tel: ${tech.telefone} | Esp: ${tech.specialty}
          <span class="excluir-btn" title="Excluir">🗑️</span>
        `;
        div.addEventListener('click', (e) => {
          if (!e.target.classList.contains('excluir-btn')) {
            iniciarEdicao(tech);
          }
        });
        div.querySelector('.excluir-btn').addEventListener('click', (e) => {
          e.stopPropagation();
          excluirTecnico(tech.matricula);
        });
        list.appendChild(div);
      });
    }

    // =============== EDIÇÃO ===============
    function iniciarEdicao(tech) {
      document.getElementById('matricula').value = tech.matricula;
      document.getElementById('name').value = tech.name;
      document.getElementById('telefone').value = tech.telefone;
      document.getElementById('specialty').value = tech.specialty;
      editingMatricula = tech.matricula;
      document.querySelector('#techForm .btn-cadastrar').textContent = 'Atualizar';
      document.getElementById('cancelEditBtn').style.display = 'inline-block';
    }

    // =============== SUBMISSÃO ===============
    document.getElementById('techForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const matricula = document.getElementById('matricula').value.trim();
      const name = document.getElementById('name').value.trim();
      const telefone = document.getElementById('telefone').value.trim();
      const specialty = document.getElementById('specialty').value.trim();

      if (!validarTelefone(telefone)) {
        displayMessage('Telefone inválido! Use o formato (XX) 9XXXX-XXXX.', 'error');
        return;
      }

      if (editingMatricula) {
        if (matricula !== editingMatricula && techs.some(t => t.matricula === matricula)) {
          displayMessage('Matrícula já cadastrada!', 'error');
          return;
        }
        techs = techs.map(t => t.matricula === editingMatricula ? { matricula, name, telefone, specialty } : t);
        adicionarAoHistorico(`Atualizado: ${matricula} (${name})`);
      } else {
        if (techs.some(t => t.matricula === matricula)) {
          displayMessage('Técnico já cadastrado!', 'error');
          return;
        }
        techs.push({ matricula, name, telefone, specialty });
        adicionarAoHistorico(`Cadastrado: ${matricula} (${name})`);
      }

      localStorage.setItem('techs', JSON.stringify(techs));
      resetForm();
      displayTechs();
      displayMessage(editingMatricula ? 'Atualizado!' : 'Cadastrado!', 'success');

      const overlay = document.getElementById('superSuccess');
      overlay.style.display = 'flex';
      setTimeout(() => overlay.style.display = 'none', 2000);
    });

    // =============== IMPORTAÇÃO VIA ARQUIVO LOCAL ===============
    document.getElementById('importBtn').addEventListener('click', function () {
      document.getElementById('fileImport').click();
    });

    document.getElementById('fileImport').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      const btn = document.getElementById('importBtn');
      const originalText = btn.textContent;
      setLoading(btn, true, originalText);

      reader.onload = function (e) {
        try {
          const data = JSON.parse(e.target.result);

          if (!Array.isArray(data)) {
            throw new Error('O arquivo deve conter um array de técnicos.');
          }

          const validData = data.filter(item =>
            item.matricula !== undefined &&
            item.name !== undefined &&
            item.telefone !== undefined &&
            item.specialty !== undefined
          );

          if (validData.length === 0) {
            throw new Error('Nenhum técnico válido encontrado.');
          }

          const newTechs = validData.filter(d => !techs.some(t => t.matricula === d.matricula));
          techs = [...techs, ...newTechs];
          localStorage.setItem('techs', JSON.stringify(techs));

          displayTechs();
          displayMessage(`Importado(s): ${newTechs.length} técnico(s) novo(s)!`, 'success');
          adicionarAoHistorico(`Importados do arquivo: ${newTechs.length} técnicos`);

        } catch (err) {
          console.error(err);
          displayMessage('Erro ao importar: ' + (err.message || 'Arquivo inválido'), 'error');
        } finally {
          setLoading(btn, false, originalText);
          event.target.value = '';
        }
      };

      reader.onerror = function () {
        displayMessage('Erro ao ler o arquivo.', 'error');
        setLoading(btn, false, originalText);
      };

      reader.readAsText(file);
    });

    // =============== LIMPAR ===============
    document.getElementById('clearBtn').addEventListener('click', function () {
      if (confirm('Apagar todos os dados?')) {
        const btn = this;
        const original = btn.textContent;
        setLoading(btn, true, original);
        setTimeout(() => {
          localStorage.removeItem('techs');
          techs = [];
          resetForm();
          displayTechs();
          displayMessage('Dados apagados!', 'success');
          adicionarAoHistorico('Todos os dados apagados');
          setLoading(btn, false, original);
        }, 300);
      }
    });

    // =============== EXPORTAR ===============
    document.getElementById('exportBtn').addEventListener('click', function () {
      const btn = this;
      const original = btn.textContent;
      setLoading(btn, true, original);
      setTimeout(() => {
        const blob = new Blob([JSON.stringify(techs, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        Object.assign(a, { href: url, download: 'tecnicos.json' });
        a.click();
        URL.revokeObjectURL(url);
        displayMessage('Exportado!', 'success');
        setLoading(btn, false, original);
      }, 200);
    });

    // =============== CANCELAR EDIÇÃO ===============
    document.getElementById('cancelEditBtn').addEventListener('click', resetForm);

    // =============== BUSCA ===============
    function searchTech() {
      const q = document.getElementById('search').value.toLowerCase();
      const f = techs.filter(t =>
        t.name.toLowerCase().includes(q) ||
        t.specialty.toLowerCase().includes(q) ||
        t.matricula.includes(q) ||
        t.telefone.includes(q)
      );
      displayTechs(f);
    }

    // =============== INICIALIZAÇÃO ===============
    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('modoAcessivel') === 'true') {
        document.body.classList.add('modo-acessivel');
      }

      displayTechs();
      atualizarHistoricoUI();
      iniciarBackupAutomatico();
      document.getElementById('matricula').focus();

      document.getElementById('toggleA11y').addEventListener('click', alternarModoAcessivel);
    });
  </script>
</body>
</html>
